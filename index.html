<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dungeon Word Dungeon</title>
    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #050816;
            color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        .game-wrapper {
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
            background: radial-gradient(circle at top, #1f2937, #020617);
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.6);
            border: 1px solid rgba(148,163,184,0.4);
        }
        h1 {
            text-align: center;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            font-size: 0.9rem;
            color: #9ca3af;
            margin-bottom: 20px;
        }
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        .badge {
            padding: 3px 8px;
            border-radius: 999px;
            background: rgba(37,99,235,0.2);
            border: 1px solid rgba(59,130,246,0.7);
            font-size: 0.8rem;
        }
        .progress {
            height: 10px;
            background: #111827;
            border-radius: 999px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        .progress-inner {
            height: 100%;
            width: 0;
            background: linear-gradient(90deg, #22c55e, #eab308, #ef4444);
            transition: width 0.3s ease-out;
        }
        .scene {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        .scene-left {
            flex: 1 1 280px;
        }
        .scene-right {
            flex: 1 1 280px;
        }
        .scene img {
            width: 100%;
            max-height: 260px;
            object-fit: cover;
            border-radius: 12px;
            border: 1px solid rgba(148,163,184,0.6);
        }
        .keywords {
            font-size: 0.85rem;
            color: #9ca3af;
            margin-top: 8px;
        }
        textarea {
            width: 100%;
            min-height: 160px;
            border-radius: 12px;
            border: 1px solid rgba(148,163,184,0.6);
            background: rgba(15,23,42,0.7);
            color: #e5e7eb;
            padding: 10px;
            resize: vertical;
            font-size: 0.9rem;
        }
        textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 1px rgba(59,130,246,0.7);
        }
        .buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        button {
            border-radius: 999px;
            border: none;
            padding: 8px 16px;
            font-size: 0.9rem;
            cursor: pointer;
        }
        .btn-primary {
            background: linear-gradient(90deg, #3b82f6, #22c55e);
            color: white;
        }
        .btn-secondary {
            background: rgba(31,41,55,0.9);
            color: #e5e7eb;
            border: 1px solid rgba(148,163,184,0.6);
        }
        .btn-primary:disabled,
        .btn-secondary:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        .score-box {
            margin-top: 10px;
            padding: 10px;
            border-radius: 12px;
            background: rgba(15,23,42,0.8);
            border: 1px solid rgba(148,163,184,0.5);
            font-size: 0.9rem;
        }
        .score-value {
            font-size: 1.4rem;
            font-weight: bold;
        }
        .score-pass {
            color: #22c55e;
        }
        .score-fail {
            color: #ef4444;
        }
        .hint {
            font-size: 0.8rem;
            color: #9ca3af;
            margin-top: 4px;
        }
        .footer-note {
            margin-top: 18px;
            font-size: 0.8rem;
            color: #6b7280;
            text-align: center;
        }
    </style>
</head>
<body>
<div class="game-wrapper">
    <h1>Word Dungeon åœ°ç‰¢è¯æ±‡é—¯å…³</h1>
    <div class="subtitle">
        æè¿°å›¾ç‰‡åœºæ™¯ï¼Œè·å¾— 0â€“1000 åˆ†ã€‚åˆ†æ•° â‰¥ <b>600</b> å³å¯é€šå…³ä¸‹ä¸€å…³ã€‚<br>
        ï¼ˆå½“å‰ Demoï¼š2 å±‚ Ã— 3 å…³ï¼Œä½ ä¹‹åå¯ä»¥æ‰©å±•æˆ 7 å±‚ Ã— 7 å…³ï¼‰
    </div>

    <div class="status-bar">
        <div>
            å½“å‰å±‚æ•°ï¼š<b id="floorLabel">1</b> / 2  
            å½“å‰å…³å¡ï¼š<b id="roomLabel">1</b> / 3
        </div>
        <div class="badge" id="passStatus">å°šæœªè¯„åˆ†</div>
    </div>

    <div class="progress">
        <div class="progress-inner" id="progressBar"></div>
    </div>

    <div class="scene">
        <div class="scene-left">
            <img id="sceneImage" src="" alt="Scene">
            <div class="keywords" id="keywordHint"></div>
        </div>
        <div class="scene-right">
            <label for="descriptionInput">è¯·ç”¨å¾·è¯­æˆ–è‹±è¯­æè¿°è¿™å¼ å›¾ç‰‡ï¼š</label>
            <textarea id="descriptionInput"
                      placeholder="ä¾‹å¦‚ï¼ˆè‹±è¯­ï¼‰ï¼šA little girl is playing with her dog in the park on a sunny day.&#10;ä¾‹å¦‚ï¼ˆå¾·è¯­ï¼‰ï¼šEin kleines MÃ¤dchen spielt an einem sonnigen Tag mit ihrem Hund im Park."></textarea>
            <div class="buttons">
                <button class="btn-primary" onclick="evaluateAnswer()">è¯„åˆ†</button>
                <button class="btn-secondary" id="nextButton" onclick="goNext()" disabled>ä¸‹ä¸€å…³ â–¶</button>
            </div>
            <div class="score-box" id="scoreBox" style="display:none;">
                æœ¬å…³åˆ†æ•°ï¼š<span class="score-value" id="scoreValue">0</span> / 1000
                <div id="scoreMessage"></div>
                <div class="hint">
                    ç®€æ˜“è¯„åˆ†è§„åˆ™ï¼šå‘½ä¸­å›¾ç‰‡å…³é”®è¯ + æè¿°è¶Šé•¿è¶Šè¯¦ç»† â†’ åˆ†æ•°è¶Šé«˜ã€‚<br>
                    æƒ³åšçœŸæ­£â€œæ‡‚è¯­ä¹‰â€çš„ AI è¯„åˆ†ï¼Œå¯ä»¥ä»¥åæ¥å…¥å¤§è¯­è¨€æ¨¡å‹ APIã€‚
                </div>
            </div>
        </div>
    </div>

    <div class="footer-note">
        æç¤ºï¼šä½ å¯ä»¥æŠŠå›¾ç‰‡å’Œå…³é”®è¯æ¢æˆè‡ªå·±çš„å¾·è¯­å­¦ä¹ ä¸»é¢˜ï¼Œæ¯”å¦‚â€œåœ¨è¶…å¸‚â€â€œåœ¨ç«è½¦ç«™â€â€œåœ¨å­¦æ ¡â€ç­‰ã€‚
    </div>
</div>

<script>
    // åœ°ç‰¢å…³å¡æ•°æ®ï¼šä½ ä»¥åå¯ä»¥æ‰©å±•æˆ 7 å±‚ Ã— 7 å…³
    // æ¯å…³ï¼šå›¾ç‰‡ + å…³é”®è¯ï¼ˆç”¨äºæ‰“åˆ†ï¼‰
    const dungeon = [
        [   // ç¬¬ 1 å±‚ï¼šç”Ÿæ´»æ—¥å¸¸
            {
                image: "https://images.pexels.com/photos/772891/pexels-photo-772891.jpeg?auto=compress&cs=tinysrgb&w=800",
                keywords: ["girl", "dog", "park", "play", "sunny"],
                cnHint: "å¥³å­© / å°ç‹— / å…¬å›­ / ç©è€ / æ™´å¤©"
            },
            {
                image: "https://images.pexels.com/photos/3184183/pexels-photo-3184183.jpeg?auto=compress&cs=tinysrgb&w=800",
                keywords: ["office", "meeting", "laptop", "team", "work"],
                cnHint: "åŠå…¬å®¤ / ä¼šè®® / ç¬”è®°æœ¬ç”µè„‘ / å›¢é˜Ÿ / å·¥ä½œ"
            },
            {
                image: "https://images.pexels.com/photos/374885/pexels-photo-374885.jpeg?auto=compress&cs=tinysrgb&w=800",
                keywords: ["train", "station", "people", "travel", "platform"],
                cnHint: "ç«è½¦ / è½¦ç«™ / äººç¾¤ / æ—…è¡Œ / æœˆå°"
            }
        ],
        [   // ç¬¬ 2 å±‚ï¼šé¤å… & åŸå¸‚
            {
                image: "https://images.pexels.com/photos/1640777/pexels-photo-1640777.jpeg?auto=compress&cs=tinysrgb&w=800",
                keywords: ["restaurant", "friends", "food", "table", "smile"],
                cnHint: "é¤å… / æœ‹å‹ / é£Ÿç‰© / é¤æ¡Œ / å¾®ç¬‘"
            },
            {
                image: "https://images.pexels.com/photos/373912/pexels-photo-373912.jpeg?auto=compress&cs=tinysrgb&w=800",
                keywords: ["city", "night", "lights", "street", "cars"],
                cnHint: "åŸå¸‚ / å¤œæ™š / ç¯å…‰ / è¡—é“ / è½¦è¾†"
            },
            {
                image: "https://images.pexels.com/photos/2566559/pexels-photo-2566559.jpeg?auto=compress&cs=tinysrgb&w=800",
                keywords: ["library", "books", "student", "reading", "study"],
                cnHint: "å›¾ä¹¦é¦† / ä¹¦ç± / å­¦ç”Ÿ / é˜…è¯» / å­¦ä¹ "
            }
        ]
    ];

    let currentFloor = 0; // ç¬¬å‡ å±‚ï¼ˆä» 0 å¼€å§‹ï¼‰
    let currentRoom = 0;  // ç¬¬å‡ å…³ï¼ˆä» 0 å¼€å§‹ï¼‰

    function loadRoom() {
        const data = dungeon[currentFloor][currentRoom];
        document.getElementById("sceneImage").src = data.image;
        document.getElementById("floorLabel").textContent = currentFloor + 1;
        document.getElementById("roomLabel").textContent = currentRoom + 1;
        document.getElementById("descriptionInput").value = "";
        document.getElementById("scoreBox").style.display = "none";
        document.getElementById("nextButton").disabled = true;
        document.getElementById("passStatus").textContent = "å°šæœªè¯„åˆ†";
        document.getElementById("passStatus").style.background = "rgba(37,99,235,0.2)";
        document.getElementById("keywordHint").innerHTML =
            "æœ¬å…³éšè—å…³é”®è¯ï¼ˆæç¤ºä½ å¦‚ä½•æè¿°å¾—æ›´å…·ä½“ï¼‰ï¼š<br>" +
            data.cnHint +
            "<br><span style='font-size:0.8rem;color:#6b7280;'>ï¼ˆä½ å¯ä»¥å°è¯•åœ¨è‹±æ–‡/å¾·è¯­æè¿°ä¸­åŒ…å«è¿™äº›æ„æ€ï¼‰</span>";

        updateProgress();
    }

    function updateProgress() {
        const totalFloors = dungeon.length;
        const roomsPerFloor = dungeon[0].length;
        const totalRooms = totalFloors * roomsPerFloor;
        const currentIndex = currentFloor * roomsPerFloor + currentRoom;
        const percent = ((currentIndex) / (totalRooms - 1)) * 100;
        document.getElementById("progressBar").style.width = percent + "%";
    }

    function evaluateAnswer() {
        const data = dungeon[currentFloor][currentRoom];
        const textRaw = document.getElementById("descriptionInput").value.trim();
        const text = textRaw.toLowerCase();

        if (text.length < 10) {
            alert("æè¿°å¤ªçŸ­å•¦ï¼Œå†å¤šå†™å‡ å¥å§ï¼ˆå¯ä»¥å†™ 2ï½3 å¥å®Œæ•´çš„æè¿°ï¼‰");
            return;
        }

        let keywordScore = 0;
        let matched = 0;
        data.keywords.forEach(kw => {
            if (text.includes(kw)) {
                matched++;
            }
        });
        if (matched > 0) {
            keywordScore = Math.min(600, (matched / data.keywords.length) * 600);
        }

        const lengthScore = Math.min(300, text.length * 3); // çº¦ 100 å­—å·¦å³å°±æ¥è¿‘ 300 åˆ†
        const logicBonus = matched >= Math.ceil(data.keywords.length / 2) ? 100 : 0;

        let total = Math.round(keywordScore + lengthScore + logicBonus);
        if (total > 1000) total = 1000;

        const passed = total >= 600;
        const scoreValueEl = document.getElementById("scoreValue");
        const scoreMessageEl = document.getElementById("scoreMessage");
        const scoreBoxEl = document.getElementById("scoreBox");
        const passStatusEl = document.getElementById("passStatus");

        scoreBoxEl.style.display = "block";
        scoreValueEl.textContent = total;
        scoreValueEl.className = "score-value " + (passed ? "score-pass" : "score-fail");

        if (passed) {
            scoreMessageEl.innerHTML = "ğŸ‰ é€šå…³æˆåŠŸï¼ä½ å¯ä»¥è¿›å…¥ä¸‹ä¸€å…³äº†ã€‚<br>å¯ä»¥å°è¯•æ”¹å†™å¾—æ›´è¯¦ç»†ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æ¥è¿‘ 1000 åˆ†ã€‚";
            passStatusEl.textContent = "å·²é€šå…³";
            passStatusEl.style.background = "rgba(34,197,94,0.25)";
            document.getElementById("nextButton").disabled = false;
        } else {
            scoreMessageEl.innerHTML = "å½“å‰åˆ†æ•°è¿˜ä¸å¤Ÿ 600ï¼Œå†è¯•ä¸€æ¬¡ï¼<br>å¤šå†™å‡ å¥ã€å°½é‡æåˆ°å›¾ç‰‡ä¸­çš„äººç‰©ã€åœ°ç‚¹ã€åŠ¨ä½œã€æ—¶é—´ç­‰ç»†èŠ‚ã€‚";
            passStatusEl.textContent = "æœªé€šå…³";
            passStatusEl.style.background = "rgba(239,68,68,0.25)";
        }
    }

    function goNext() {
        const roomsPerFloor = dungeon[0].length;
        const totalFloors = dungeon.length;

        if (currentRoom < roomsPerFloor - 1) {
            currentRoom++;
        } else {
            if (currentFloor < totalFloors - 1) {
                currentFloor++;
                currentRoom = 0;
            } else {
                alert("ğŸ‰ æ­å–œä½ ï¼Œå·²ç»é€šå…³æ‰€æœ‰åœ°ç‰¢å…³å¡ï¼ˆDemo ç‰ˆï¼‰ï¼\nä½ å¯ä»¥åœ¨ä»£ç é‡Œç»§ç»­æ·»åŠ æ›´å¤šå±‚å’Œæ›´å¤šå…³å¡ã€‚");
                return;
            }
        }
        loadRoom();
    }

    // åˆå§‹åŒ–
    loadRoom();
</script>
</body>
</html>