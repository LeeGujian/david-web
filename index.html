<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Word Dungeon - 7Ã—7 åœ°ç‰¢æè¿°é—¯å…³</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        * { box-sizing: border-box; }
        body {
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: radial-gradient(circle at top, #1f2937 0, #020617 55%, #000 100%);
            color: #e5e7eb;
        }
        .wrapper {
            max-width: 960px;
            margin: 24px auto;
            padding: 20px;
            border-radius: 18px;
            background: rgba(15,23,42,0.96);
            box-shadow: 0 24px 60px rgba(0,0,0,0.75);
            border: 1px solid rgba(148,163,184,0.5);
        }
        h1 {
            margin: 0 0 6px;
            text-align: center;
        }
        .subtitle {
            text-align: center;
            font-size: 0.9rem;
            color: #9ca3af;
            margin-bottom: 18px;
        }
        .status-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        .badge {
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 0.8rem;
            border: 1px solid rgba(148,163,184,0.7);
            background: rgba(15,23,42,0.8);
        }
        .badge-pass {
            border-color: rgba(34,197,94,0.9);
            background: rgba(22,163,74,0.16);
            color: #bbf7d0;
        }
        .badge-fail {
            border-color: rgba(248,113,113,0.9);
            background: rgba(248,113,113,0.16);
            color: #fecaca;
        }
        .progress {
            width: 100%;
            height: 10px;
            border-radius: 999px;
            background: #020617;
            overflow: hidden;
            margin-bottom: 12px;
        }
        .progress-inner {
            height: 100%;
            width: 0;
            background: linear-gradient(90deg, #22c55e, #eab308, #ef4444);
            transition: width .3s ease-out;
        }
        .layout {
            display: flex;
            flex-wrap: wrap;
            gap: 18px;
        }
        .left, .right {
            flex: 1 1 300px;
        }
        .scene-img {
            width: 100%;
            max-height: 280px;
            border-radius: 14px;
            object-fit: cover;
            background: #020617;
            border: 1px solid rgba(55,65,81,0.9);
        }
        .hint-box {
            margin-top: 8px;
            font-size: 0.85rem;
            color: #9ca3af;
        }
        textarea {
            width: 100%;
            min-height: 170px;
            border-radius: 14px;
            border: 1px solid rgba(55,65,81,0.9);
            background: rgba(15,23,42,0.9);
            color: #e5e7eb;
            padding: 10px 12px;
            font-size: 0.9rem;
            resize: vertical;
        }
        textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 1px rgba(59,130,246,0.8);
        }
        .label {
            font-size: 0.9rem;
            margin-bottom: 4px;
        }
        .textarea-hint {
            font-size: 0.8rem;
            color: #9ca3af;
            margin-top: 4px;
        }
        .btn-row {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        button {
            border-radius: 999px;
            border: none;
            padding: 8px 18px;
            font-size: 0.9rem;
            cursor: pointer;
        }
        .btn-primary {
            background: linear-gradient(90deg, #3b82f6, #22c55e);
            color: #f9fafb;
        }
        .btn-secondary {
            background: rgba(17,24,39,0.9);
            color: #e5e7eb;
            border: 1px solid rgba(107,114,128,0.8);
        }
        .btn-secondary:disabled,
        .btn-primary:disabled {
            opacity: .45;
            cursor: not-allowed;
        }
        .score-box {
            margin-top: 10px;
            padding: 10px 12px;
            border-radius: 14px;
            background: rgba(3,7,18,0.9);
            border: 1px solid rgba(75,85,99,0.9);
            font-size: 0.9rem;
        }
        .score-value {
            font-size: 1.6rem;
            font-weight: 700;
        }
        .score-good { color: #4ade80; }
        .score-bad { color: #f97373; }
        .score-msg {
            margin-top: 4px;
        }
        .footer-note {
            margin-top: 16px;
            font-size: 0.8rem;
            color: #9ca3af;
            text-align: center;
        }
        @media (max-width: 640px) {
            .wrapper { margin: 10px; padding: 14px; }
        }
    </style>
</head>
<body>
<div class="wrapper">
    <h1>Word Dungeon Â· åœ°ç‰¢ 49 å…³æè¿°é—¯å…³</h1>
    <div class="subtitle">
        æ¯å…³è‡ªåŠ¨ç”Ÿæˆä¸€å¼ ä¸»é¢˜å›¾ç‰‡ï¼Œè¯·ç”¨ <b>è‹±è¯­æˆ–å¾·è¯­</b> æè¿°åœºæ™¯ã€‚<br>
        æè¿°è¶Šä¸°å¯Œã€è¶Šè´´è¿‘ä¸»é¢˜ï¼Œåˆ†æ•°è¶Šé«˜ã€‚åˆ†æ•° â‰¥ <b>600 / 1000</b> å³å¯è¿›å…¥ä¸‹ä¸€å…³ã€‚
    </div>

    <div class="status-row">
        <div>å±‚æ•°ï¼š<b id="floorLabel">1</b> / 7</div>
        <div>å…³å¡ï¼š<b id="roomLabel">1</b> / 7</div>
        <div>å·²é€šå…³ï¼š<b id="clearedLabel">0</b> / 49</div>
        <div id="badge" class="badge">æœªè¯„åˆ†</div>
    </div>

    <div class="progress">
        <div id="progressInner" class="progress-inner"></div>
    </div>

    <div class="layout">
        <div class="left">
            <img id="sceneImg" class="scene-img" src="" alt="Scene">
            <div id="hintBox" class="hint-box"></div>
        </div>
        <div class="right">
            <div class="label">è¯·æè¿°å›¾ç‰‡ï¼ˆè‹±æ–‡æˆ–å¾·è¯­ï¼‰ï¼š</div>
            <textarea id="desc" placeholder="å¯ä»¥å†™ï¼šäººç‰©ã€åœ°ç‚¹ã€æ—¶é—´ã€åŠ¨ä½œã€åŸå› ã€æ„Ÿå—ç­‰ã€‚è‡³å°‘ 2â€“3 å¥ã€‚"></textarea>
            <div class="textarea-hint">
                å°æŠ€å·§ï¼šå…ˆå†™ä¸€å¥æ€»çš„æè¿°ï¼Œå†å†™ 2â€“3 å¥ç»†èŠ‚ï¼ˆè° / åœ¨å“ªé‡Œ / åšä»€ä¹ˆ / ä¸ºä»€ä¹ˆ / å¿ƒæƒ…å¦‚ä½•ï¼‰ï¼Œåˆ†æ•°ä¼šæ˜æ˜¾æé«˜ã€‚
            </div>
            <div class="btn-row">
                <button class="btn-primary" id="scoreBtn">è¯„åˆ†</button>
                <button class="btn-secondary" id="nextBtn" disabled>ä¸‹ä¸€å…³ â–¶</button>
                <button class="btn-secondary" id="retryBtn">é‡æŠ½å›¾ç‰‡</button>
            </div>
            <div id="scoreBox" class="score-box" style="display:none;">
                æœ¬å…³å¾—åˆ†ï¼š<span id="scoreValue" class="score-value"></span> / 1000
                <div id="scoreMsg" class="score-msg"></div>
                <div style="margin-top:6px;font-size:0.8rem;color:#9ca3af;">
                    è¯„åˆ†è§„åˆ™ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š<br>
                    Â· æè¿°è¶Šé•¿ã€ä¿¡æ¯è¶Šä¸°å¯Œï¼šæœ€å¤šçº¦ 700 åˆ†<br>
                    Â· å‘½ä¸­æœ¬å…³ä¸»é¢˜å…³é”®è¯ï¼ˆè‹±æ–‡ï¼‰è¶Šå¤šï¼šæœ€å¤šçº¦ 300 åˆ†<br>
                    Â· ä¸éœ€è¦å®Œç¾è¯­æ³•ï¼Œåªè¦å†…å®¹åˆç†ã€æœ‰ç»†èŠ‚ï¼Œå°±èƒ½è½»æ¾è¿‡ 600ã€‚
                </div>
            </div>
        </div>
    </div>

    <div class="footer-note">
        æç¤ºï¼šä»¥åä½ å¯ä»¥æŠŠæ¯ä¸€å±‚æ”¹æˆå¾·è¯­è€ƒè¯•çš„ä¸åŒä¸»é¢˜ï¼ˆå­¦æ ¡ã€å·¥ä½œã€å¥åº·ã€æ—…è¡Œâ€¦â€¦ï¼‰ï¼Œ<br>
        è¿™æ ·æ¯å¤©ç©ä¸€ä¼šå„¿ï¼Œå°±åœ¨åˆ· B1/B2 å†™ä½œå’Œå£è¯­ç´ æã€‚
    </div>
</div>

<script>
    // 7 å±‚ Ã— 7 å…³ï¼šæ¯å…³ä¸€ä¸ªè‹±æ–‡ä¸»é¢˜æ ‡ç­¾ + ä¸­æ–‡æç¤º
    const dungeon = [
        [   // Floor 1 æ—¥å¸¸ç”Ÿæ´»
            { slug: "girl,dog,park",        hint: "å¥³å­© / å°ç‹— / å…¬å›­ / è‰åœ° / ç©è€" },
            { slug: "family,livingroom",    hint: "å®¶åº­ / å®¢å… / æ²™å‘ / èŠå¤© / ç”µè§†" },
            { slug: "kitchen,cooking",      hint: "å¨æˆ¿ / åšé¥­ / é”…ç¢—ç“¢ç›† / å‡†å¤‡é£Ÿç‰©" },
            { slug: "shopping,market",      hint: "è¶…å¸‚ / è´­ç‰©è½¦ / è´§æ¶ / ç»“è´¦" },
            { slug: "street,people,day",    hint: "è¡—é“ / è¡Œäºº / ç™½å¤© / è½¦è¾†" },
            { slug: "playground,children",  hint: "æ¸¸ä¹åœº / å°å­© / ç§‹åƒ / æ»‘æ¢¯" },
            { slug: "bedroom,reading",      hint: "å§å®¤ / ä¹¦ / åºŠ / é˜…è¯» / æ”¾æ¾" }
        ],
        [   // Floor 2 å­¦æ ¡ & å­¦ä¹ 
            { slug: "classroom,students",   hint: "æ•™å®¤ / å­¦ç”Ÿ / è€å¸ˆ / é»‘æ¿" },
            { slug: "library,books,study",  hint: "å›¾ä¹¦é¦† / ä¹¦æ¶ / è‡ªä¹  / å®‰é™" },
            { slug: "exam,desk,school",     hint: "è€ƒè¯• / è¯¾æ¡Œ / å·å­ / ç´§å¼ " },
            { slug: "schoolyard,friends",   hint: "æ“åœº / åŒå­¦ / èŠå¤© / ä¼‘æ¯" },
            { slug: "computer,online,study",hint: "ç”µè„‘ / ç½‘è¯¾ / è¿œç¨‹å­¦ä¹ " },
            { slug: "science,lab,students", hint: "å®éªŒå®¤ / ç™½å¤§è¤‚ / å®éªŒ" },
            { slug: "graduation,cap,gown",  hint: "æ¯•ä¸š / å­¦å£«æœ / åˆå½± / åº†ç¥" }
        ],
        [   // Floor 3 åŸå¸‚ & äº¤é€š
            { slug: "train,station,travel", hint: "ç«è½¦ / è½¦ç«™ / è¡Œæ / æœˆå°" },
            { slug: "bus,stop,people",      hint: "å…¬äº¤è½¦ / è½¦ç«™ç‰Œ / ç­‰è½¦" },
            { slug: "subway,metro,city",    hint: "åœ°é“ / è½¦å¢ / äººç¾¤" },
            { slug: "airport,airplane",     hint: "æœºåœº / é£æœº / ç™»æœºå£ / å®‰æ£€" },
            { slug: "bicycle,road,city",    hint: "è‡ªè¡Œè½¦ / è‡ªè¡Œè½¦é“ / åŸå¸‚" },
            { slug: "traffic,jam,cars",     hint: "å µè½¦ / é«˜é€Ÿ / å¾ˆå¤šè½¦" },
            { slug: "night,city,lights",    hint: "åŸå¸‚å¤œæ™¯ / éœ“è™¹ç¯ / é«˜æ¥¼" }
        ],
        [   // Floor 4 å·¥ä½œ & èŒä¸š
            { slug: "office,team,meeting",  hint: "åŠå…¬å®¤ / ä¼šè®® / è®¨è®º" },
            { slug: "restaurant,chef,kitchen",hint:"é¤å… / å¨å¸ˆ / åå¨ / çƒ¹é¥ª" },
            { slug: "factory,workers,machine",hint:"å·¥å‚ / æœºå™¨ / å·¥äºº / ç”Ÿäº§çº¿" },
            { slug: "hospital,doctor,nurse",hint:"åŒ»é™¢ / åŒ»ç”Ÿ / æŠ¤å£« / ç—…äºº" },
            { slug: "construction,workers", hint:"å·¥åœ° / å®‰å…¨å¸½ / å»ºæ¥¼" },
            { slug: "hotel,reception,lobby",hint:"é…’åº— / å‰å° / å¤§å…" },
            { slug: "police,street,car",    hint:"è­¦å¯Ÿ / å·¡é€»è½¦ / è¡—é“" }
        ],
        [   // Floor 5 ä¼‘é—² & è‡ªç„¶
            { slug: "beach,sea,holiday",    hint:"æµ·è¾¹ / æ²™æ»© / åº¦å‡" },
            { slug: "mountain,hiking,path", hint:"å±± / å¾’æ­¥ / å°è·¯ / èƒŒåŒ…" },
            { slug: "forest,trees,sunlight",hint:"æ£®æ— / é˜³å…‰ / æ ‘æ—" },
            { slug: "park,jogging,sport",   hint:"å…¬å›­ / è·‘æ­¥ / é”»ç‚¼" },
            { slug: "lake,boat,relax",      hint:"æ¹– / å°èˆ¹ / æ”¾æ¾" },
            { slug: "camping,tent,night",   hint:"éœ²è¥ / å¸ç¯· / æ˜Ÿæ˜Ÿ / ç¯ç«" },
            { slug: "snow,winter,play",     hint:"é›ª / å†¬å¤© / æ‰“é›ªä»— / å †é›ªäºº" }
        ],
        [   // Floor 6 å¥åº· & æ—¥å¸¸æœåŠ¡
            { slug: "gym,fitness,training", hint:"å¥èº«æˆ¿ / å™¨æ¢° / è®­ç»ƒ" },
            { slug: "pharmacy,medicine",    hint:"è¯åº— / è¯å“ / è´§æ¶" },
            { slug: "dentist,clinic",       hint:"ç‰™åŒ» / è¯Šæ‰€ / æ¤…å­" },
            { slug: "hairdresser,salon",    hint:"ç†å‘åº— / ç†å‘å¸ˆ / å‰ªå¤´å‘" },
            { slug: "supermarket,shopping", hint:"è¶…å¸‚ / ä¹°èœ / æ”¶é“¶å°" },
            { slug: "market,fruit,vegetable",hint:"èœå¸‚åœº / æ°´æœ / è”¬èœ" },
            { slug: "cleaning,housework",   hint:"æ‰“æ‰«å«ç”Ÿ / å¸å°˜å™¨ / åšå®¶åŠ¡" }
        ],
        [   // Floor 7 å¥‡å¹» & å†’é™©ï¼ˆçœŸæ­£åœ°ç‰¢ï¼‰
            { slug: "fantasy,dungeon,torch",hint:"åœ°ç‰¢ / ç«æŠŠ / çŸ³å¢™ / é˜´æš—" },
            { slug: "castle,night,moon",    hint:"åŸå ¡ / æœˆäº® / å¤œæ™š" },
            { slug: "dragon,fire,sky",      hint:"å·¨é¾™ / ç«ç„° / æˆ˜æ–—" },
            { slug: "knight,armor,sword",   hint:"éª‘å£« / ç›”ç”² / é•¿å‰‘" },
            { slug: "magic,spell,wizard",   hint:"é­”æ³• / æ³•å¸ˆ / å…‰èŠ’" },
            { slug: "village,market,people",hint:"æ‘åº„ / é›†å¸‚ / æ‘æ°‘" },
            { slug: "battle,warrior,field", hint:"æˆ˜åœº / æˆ˜å£« / å†²é”‹" }
        ]
    ];

    const totalFloors = dungeon.length;
    const roomsPerFloor = dungeon[0].length;
    const totalRooms = totalFloors * roomsPerFloor;

    let floorIndex = 0; // 0â€“6
    let roomIndex  = 0; // 0â€“6
    let clearedCount = 0;

    const floorLabel   = document.getElementById("floorLabel");
    const roomLabel    = document.getElementById("roomLabel");
    const clearedLabel = document.getElementById("clearedLabel");
    const badge        = document.getElementById("badge");
    const progressBar  = document.getElementById("progressInner");
    const sceneImg     = document.getElementById("sceneImg");
    const hintBox      = document.getElementById("hintBox");
    const descInput    = document.getElementById("desc");
    const scoreBox     = document.getElementById("scoreBox");
    const scoreValueEl = document.getElementById("scoreValue");
    const scoreMsgEl   = document.getElementById("scoreMsg");
    const scoreBtn     = document.getElementById("scoreBtn");
    const nextBtn      = document.getElementById("nextBtn");
    const retryBtn     = document.getElementById("retryBtn");

    function buildImageUrl(slug) {
        // ä½¿ç”¨ loremflickrï¼Œé€šå¸¸åœ¨å›½å†…ä¹Ÿèƒ½è®¿é—®ã€‚
        // random å‚æ•°ä¿è¯ä¸åŒå…³å¡å›¾ç‰‡ä¸åŒã€‚
        const key = floorIndex * roomsPerFloor + roomIndex + 1;
        return "https://loremflickr.com/800/500/" + encodeURIComponent(slug) + "?random=" + key;
    }

    function updateProgress() {
        const idx = floorIndex * roomsPerFloor + roomIndex;
        const percent = (idx / (totalRooms - 1)) * 100;
        progressBar.style.width = percent + "%";
    }

    function loadRoom(resetImage = true) {
        const room = dungeon[floorIndex][roomIndex];

        floorLabel.textContent   = floorIndex + 1;
        roomLabel.textContent    = roomIndex + 1;
        clearedLabel.textContent = clearedCount;

        badge.textContent = "æœªè¯„åˆ†";
        badge.className   = "badge";

        if (resetImage) {
            sceneImg.src = buildImageUrl(room.slug);
        }

        hintBox.innerHTML =
            "æœ¬å…³ä¸»é¢˜è‹±æ–‡æ ‡ç­¾ï¼š<b>" + room.slug.replace(/,/g, ", ") +
            "</b><br>å¯ä»¥å°è¯•åœ¨æè¿°ä¸­åŒ…å«è¿™äº›æ„æ€ï¼š<span style='color:#e5e7eb;'>" +
            room.hint +
            "</span>";

        descInput.value = "";
        scoreBox.style.display = "none";
        nextBtn.disabled = true;

        updateProgress();
    }

    function getKeywords(room) {
        return room.slug.split(",");
    }

    function evaluateScore() {
        const raw = descInput.value.trim();
        const text = raw.toLowerCase();

        if (raw.length < 20) {
            alert("å†™å¾—æœ‰ç‚¹å¤ªå°‘å•¦ï¼Œè‡³å°‘å†™ä¸¤ä¸‰å¥ï¼Œå†è¯•ä¸€æ¬¡ã€‚");
            return;
        }

        const room = dungeon[floorIndex][roomIndex];
        const keywords = getKeywords(room);

        // å‘½ä¸­å¤šå°‘è‹±æ–‡å…³é”®è¯
        let hits = 0;
        for (const kw of keywords) {
            if (kw && text.includes(kw.toLowerCase())) {
                hits++;
            }
        }

        // æè¿°é•¿åº¦åˆ†ï¼šæœ€å¤šçº¦ 700 åˆ†ï¼ˆ350 å­—å·¦å³ï¼‰
        const lengthScore = Math.min(700, raw.length * 2);

        // å…³é”®è¯åˆ†ï¼šæœ€å¤š 300 åˆ†
        const keywordScore = Math.min(300, hits / keywords.length * 300);

        let total = Math.round(lengthScore + keywordScore);
        if (total > 1000) total = 1000;

        const passed = total >= 600;

        scoreBox.style.display = "block";
        scoreValueEl.textContent = total;
        scoreValueEl.className = "score-value " + (passed ? "score-good" : "score-bad");

        if (passed) {
            scoreMsgEl.innerHTML =
                "ğŸ‰ æ­å–œé€šå…³ï¼ä½ å¯ä»¥ç‚¹å‡»ã€Œä¸‹ä¸€å…³ã€ç»§ç»­æ·±å…¥åœ°ç‰¢ã€‚<br>" +
                "å¦‚æœæƒ³æŒ‘æˆ˜é«˜åˆ†ï¼Œå¯ä»¥å°è¯•ï¼šå¢åŠ åŸå› ã€æ„Ÿå—ã€ç»†èŠ‚æå†™ï¼Œæ¯”å¦‚æ—¶é—´ã€å¤©æ°”ã€äººç‰©å…³ç³»ç­‰ã€‚";
            badge.textContent = "å·²é€šå…³";
            badge.className   = "badge badge-pass";
            nextBtn.disabled  = false;

            // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¿‡è¿™å…³ï¼Œå¢åŠ é€šå…³è®¡æ•°
            // è¿™é‡Œç®€å•å¤„ç†ï¼šæ¯æ¬¡é€šè¿‡å°± +1ï¼ˆåˆ·æ–°åä¸è®°å¿†ï¼‰
            clearedCount++;
            clearedLabel.textContent = clearedCount;
        } else {
            scoreMsgEl.innerHTML =
                "å½“å‰åˆ†æ•°è¿˜æ²¡åˆ° 600ï¼Œå¯ä»¥å¤šå†™ä¸€ç‚¹ã€å†™å¾—æ›´å…·ä½“ï¼š<br>" +
                "Â· å°è¯•æåˆ°äººç‰©åœ¨åšä»€ä¹ˆã€åœ¨å“ªé‡Œã€ä¸ºä»€ä¹ˆåœ¨è¿™é‡Œï¼›<br>" +
                "Â· çœ‹ä¸‹æ–¹æç¤ºä¸­çš„ä¸­æ–‡å…³é”®è¯ï¼Œé€‚å½“ç”¨è‹±æ–‡/å¾·è¯­è¡¨è¾¾å‡ºæ¥ã€‚";
            badge.textContent = "æœªé€šå…³";
            badge.className   = "badge badge-fail";
        }
    }

    function goNext() {
        if (roomIndex < roomsPerFloor - 1) {
            roomIndex++;
        } else {
            if (floorIndex < totalFloors - 1) {
                floorIndex++;
                roomIndex = 0;
            } else {
                alert("ğŸ‰ ä½ å·²ç»é€šå…³å…¨éƒ¨ 49 å…³ï¼å¯ä»¥åˆ·æ–°é¡µé¢é‡æ¥ä¸€è½®ï¼Œæˆ–è€…è‡ªå·±æ”¹ä»£ç å¢åŠ æ–°å…³å¡ã€‚");
                return;
            }
        }
        loadRoom(true);
    }

    function redrawImage() {
        // ä¿æŒåŒä¸€å…³ï¼Œä½†é‡æ–°æŠ½ä¸€å¼ å›¾
        const room = dungeon[floorIndex][roomIndex];
        sceneImg.src = buildImageUrl(room.slug + ",scene");
    }

    scoreBtn.addEventListener("click", evaluateScore);
    nextBtn.addEventListener("click", goNext);
    retryBtn.addEventListener("click", redrawImage);

    // åˆå§‹åŒ–
    loadRoom(true);
</script>
</body>
</html>