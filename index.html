<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Word Dungeon - 7Ã—7 åœ°ç‰¢æè¿°é—¯å…³</title>
<style>
    body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont;
        background: #0f0f17;
        color: #f4f4f4;
        margin: 0;
        padding: 0;
    }
    .wrap {
        max-width: 900px;
        margin: 20px auto;
        padding: 25px;
        border-radius: 20px;
        background: #1a1a29;
        box-shadow: 0 0 25px rgba(0,0,0,0.6);
    }
    h1 { text-align:center; }
    .info { text-align:center; color:#bbb; margin-bottom:20px; }
    .status { display:flex; justify-content:space-between; }
    .badge {
        padding:4px 10px;
        border-radius:30px;
        font-size:0.85rem;
    }
    .scene-img {
        width:100%;
        height:260px;
        border-radius:15px;
        object-fit:cover;
        margin:15px 0;
        border:1px solid #333;
    }
    textarea {
        width:100%;
        height:150px;
        background:#111;
        color:white;
        border:1px solid #444;
        border-radius:12px;
        padding:10px;
        margin-top:5px;
    }
    button {
        border:none;
        border-radius:30px;
        padding:10px 20px;
        margin-right:10px;
        cursor:pointer;
    }
    .btn-main {
        background:#4a78ff;
        color:white;
    }
    .btn-next {
        background:#333;
        color:#ccc;
    }
    .btn-next:disabled { opacity:0.4; cursor:not-allowed; }
    .score-box {
        background:#12121d;
        padding:12px;
        border-radius:12px;
        margin-top:10px;
        border:1px solid #333;
    }
    .score-value { font-size:1.5rem; }
    .good { color:#21d07a; }
    .bad { color:#ff4d4d; }
</style>
</head>
<body>

<div class="wrap">
<h1>Word Dungeon - åœ°ç‰¢ 49 å…³æè¿°é—¯å…³</h1>
<div class="info">
æè¿°éšæœºå›¾ç‰‡ï¼Œåªè¦ â‰¥ 600 åˆ†å³å¯é€šå…³ã€‚  
æœ¬æ¸¸æˆå…±æœ‰ <b>7 å±‚ Ã— 7 å…³ = 49 å…³</b>ã€‚
</div>

<div class="status">
    <div>å±‚æ•°ï¼š<b id="floorDisplay">1</b> / 7</div>
    <div>å…³å¡ï¼š<b id="roomDisplay">1</b> / 7</div>
    <div class="badge" id="passBadge" style="background:#333;">æœªè¯„åˆ†</div>
</div>

<img id="sceneImg" class="scene-img" src="">

<div id="hintBox" style="color:#888; font-size:0.9rem;"></div>

<label>è¯·æè¿°å›¾ç‰‡ï¼ˆè‹±æ–‡æˆ–å¾·è¯­ï¼‰ï¼š</label>
<textarea id="desc"></textarea>

<button class="btn-main" onclick="score()">è¯„åˆ†</button>
<button class="btn-next" id="nextBtn" onclick="next()" disabled>ä¸‹ä¸€å…³ â–¶</button>

<div id="scoreBox" class="score-box" style="display:none;">
    å¾—åˆ†ï¼š<span id="scoreValue" class="score-value"></span> / 1000
    <div id="scoreMsg"></div>
</div>

</div>

<script>
// 7 å±‚ Ã— 7 å…³ä¸»é¢˜
const topics = [
    ["girl,dog,park","office,team,work","train,station","kitchen,cooking","city,street","shopping,market","classroom,school"],
    ["restaurant,food","night,city","library,books","beach,sea","mountain,hiking","forest,path","bicycle,road"],
    ["doctor,hospital","airport,travel","sports,running","family,home","computer,desk","coffee,cafe","winter,snow"],
    ["music,concert","gym,fitness","swimming,pool","hotel,room","bus,transport","subway,metro","farm,animals"],
    ["lake,boat","bridge,river","sunset,sky","food,cooking","museum,art","garden,flowers","car,traffic"],
    ["students,study","train,platform","office,work","store,supermarket","kitchen,chef","football,soccer","city,night"],
    ["fantasy,dungeon","magic,castle","dragon,fire","dark,forest","knight,armor","village,market","battle,warrior"]
];

// æ¯å…³å…³é”®è¯ = topic æ‹†æˆæ•°ç»„
function keywordsFrom(topic) {
    return topic.split(","); 
}

let floor = 0; // 0~6
let room = 0;  // 0~6

function loadStage() {
    const topic = topics[floor][room];
    document.getElementById("floorDisplay").innerText = floor+1;
    document.getElementById("roomDisplay").innerText = room+1;

    // ç”Ÿæˆéšæœºå›¾ç‰‡
    const url = "https://source.unsplash.com/random/800x600/?" + topic;
    document.getElementById("sceneImg").src = url;

    document.getElementById("passBadge").innerText = "æœªè¯„åˆ†";
    document.getElementById("passBadge").style.background = "#333";

    document.getElementById("desc").value = "";
    document.getElementById("scoreBox").style.display = "none";
    document.getElementById("nextBtn").disabled = true;

    document.getElementById("hintBox").innerHTML = 
        "æœ¬å…³ä¸»é¢˜å…³é”®è¯ï¼š" + topic.replace(/,/g, ", ");
}

function score() {
    const text = document.getElementById("desc").value.toLowerCase().trim();
    const keys = keywordsFrom(topics[floor][room]);

    if (text.length < 10) {
        alert("å†™å¤ªå°‘äº†ï¼Œå¤šå†™å‡ å¥ï¼");
        return;
    }

    let match = 0;
    for (let k of keys) {
        if (text.includes(k)) match++;
    }

    let keywordScore = Math.min(600, match / keys.length * 600);
    let lengthScore = Math.min(300, text.length * 1.5);
    let logic = match >= Math.ceil(keys.length / 2) ? 100 : 0;

    let total = Math.min(1000, Math.round(keywordScore + lengthScore + logic));

    const pass = total >= 600;

    document.getElementById("scoreBox").style.display = "block";
    document.getElementById("scoreValue").innerText = total;
    document.getElementById("scoreValue").className = pass ? "score-value good" : "score-value bad";

    document.getElementById("scoreMsg").innerHTML = pass
        ? "ğŸ‰ é€šè¿‡ï¼ä½ å¯ä»¥è¿›å…¥ä¸‹ä¸€å…³ã€‚"
        : "åˆ†æ•°ä¸è¶³ 600ï¼Œå†å†™å¾—æ›´å…·ä½“ã€æ›´å¤šæƒ…èŠ‚ï¼";

    document.getElementById("passBadge").innerText = pass ? "å·²é€šè¿‡" : "æœªé€šè¿‡";
    document.getElementById("passBadge").style.background = pass ? "#1f8c5c" : "#552222";

    if (pass) document.getElementById("nextBtn").disabled = false;
}

function next() {
    if (room < 6) room++;
    else {
        if (floor < 6) {
            floor++;
            room = 0;
        } else {
            alert("ğŸ‰ æ­å–œä½ ï¼ä½ å·²é€šå…³å…¨éƒ¨ 49 å…³ï¼");
            return;
        }
    }
    loadStage();
}

loadStage();
</script>

</body>
</html>